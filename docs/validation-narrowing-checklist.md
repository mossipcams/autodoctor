# Validation Narrowing Implementation Checklist

> **Status (2026-02-01):** All phases implemented. Phases 1-6 were completed in v2.7.0-v2.13.x. Three additional cuts (for_each extraction, filter argument validation, template entity validation) were completed in v2.14.0.

## Phase 1: Remove Undefined Variable Checking -- DONE (v2.7.0)

**Goal:** Eliminate the #1 source of false positives

### Code Changes

- [x] **models.py** -- `TEMPLATE_UNKNOWN_VARIABLE` removed
- [x] **jinja_validator.py** -- `_validate_variable()` method and call site removed
- [x] **Test Updates** -- Variable-related tests removed

---

## Phase 2: Make Filter/Test Validation Opt-In -- DONE (v2.7.0)

**Goal:** Stop flagging custom filters/tests by default

- [x] **const.py** -- `CONF_STRICT_TEMPLATE_VALIDATION` added
- [x] **config_flow.py** -- Checkbox option added
- [x] **jinja_validator.py** -- `strict_template_validation` parameter implemented
- [x] **__init__.py** -- Options passed to JinjaValidator

---

## Phase 3: Conservative State Validation -- DONE (v2.7.0)

**Goal:** Only validate states for well-known, stable domains

- [x] **validator.py** -- `STATE_VALIDATION_WHITELIST` added, `_validate_state()` checks whitelist, severity downgrades applied
- [x] **jinja_validator.py** -- Superseded: template entity/state validation removed entirely in v2.14.0 Phase 24

---

## Phase 4: Simplify Service Parameter Type Checking -- DONE (v2.7.0)

**Goal:** Only validate discrete enum/select options, not basic types

- [x] **service_validator.py** -- Type checking simplified to select/enum options only

---

## Phase 5: Make Service Unknown Param Checking Opt-In -- DONE (v2.7.0)

**Goal:** Allow users to disable unknown param warnings if desired

- [x] **const.py** -- `CONF_STRICT_SERVICE_VALIDATION` added
- [x] **config_flow.py** -- Checkbox option added
- [x] **service_validator.py** -- `strict_service_validation` parameter implemented

---

## Phase 6: Improve Fuzzy Matching -- DONE (v2.7.0)

**Goal:** Better suggestions, fewer confusing ones

- [x] **validator.py** -- Fuzzy match cutoff increased to 0.75

---

## Testing -- DONE

All test updates completed. 471 tests passing, 2 skipped as of v2.14.0.

---

## Documentation Updates -- DONE

- [x] `index.md` updated with validation narrowing section
- [x] `README.md` updated with current validation scope
- [x] Configuration options documented
- [x] Changelogs generated by release-please

---

## v2.14.0 Additional Cuts

Three additional validation paths identified as false-positive sources were removed in v2.14.0:

- [x] **Phase 22**: `for_each` entity extraction removed from `analyzer.py` (dead code path)
- [x] **Phase 23**: Filter argument count validation removed; `CatalogEntry` simplified (no `min_args`/`max_args`)
- [x] **Phase 24**: Template entity validation removed from `jinja_validator.py`; cross-family dedup removed from `__init__.py`; 7 `TEMPLATE_*` IssueType members removed (21 â†’ 13)

## Success Criteria -- MET

- [x] False positive rate < 5%
- [x] Test suite passes 100% (471 passed, 2 skipped)
- [x] Config options work correctly
- [x] Mutation testing implemented (v2.12.1-v2.12.2)
